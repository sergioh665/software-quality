name: Vue.js CI

on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: "21.7.1"

      - name: Set up Java JDK
        uses: actions/setup-java@v3
        with:
          java-version: "21"
          distribution: "temurin"

      - name: Install dependencies
        run: npm install

      - name: Install jscpd globally
        run: npm install -g jscpd

      - name: Check for code duplication
        run: jscpd AluguelFestas/src/views/Temas

      - name: Install Graphviz
        run: sudo apt-get install -y graphviz

      - name: Download PlantUML
        run: |
          wget https://github.com/plantuml/plantuml/releases/download/v1.2023.10/plantuml-1.2023.10.jar -O plantuml.jar

      - name: Verify PlantUML jar file
        run: ls -la plantuml.jar

      - name: Check PlantUML version
        run: java -jar plantuml.jar -version

      - name: Create simple UML file for testing
        run: |
          echo "@startuml\nAlice -> Bob: Hello\n@enduml" > uml/test.puml

      - name: Ensure diagrams directory exists
        run: mkdir -p generated_diagrams

      - name: Check if the UML file exists
        run: |
          echo "Checking if the file exists at path: uml/test.puml"
          if [ -f uml/test.puml ]; then echo "File exists"; else echo "File does not exist"; fi

      - name: Generate UML Diagram with verbose output
        run: |
          java -jar plantuml.jar -tpng -o generated_diagrams uml/test.puml -verbose

      - name: List generated diagrams directory
        run: |
          echo "Listing files in generated_diagrams/ after PlantUML generation:";
          ls -la generated_diagrams/

      - name: Upload UML diagram as artifact
        uses: actions/upload-artifact@v4.4.3
        with:
          name: uml-diagram
          path: generated_diagrams/*.png

      - name: Upload production-ready build files
        uses: actions/upload-artifact@v4.4.3
        with:
          name: build
          path: dist
